    
         6. КОМАНДНОЕ РЕДАКТИРОВАНИЕ
    
         6.1. Ввод командной стpоки
    
    Для перехода в командный режим  необ-
ходимо  нажать клавишу <ESC> или, как это
чаще  всего  используется  в   редакторах
CP/M, клавишу ^K.
    Символ  *  (знак  умножения) является
указателем командного режима.  При  вводе
команд  можно использовать клавиши редак-
тирования строки:
    ^Y - сброс всей командной строки;
    BS и DEL - удалить  символ  слева  от
курсора.
    Выполнение командной строки начинает-
ся  после нажатия клавиши <ENTER>. Разде-
лителем в командной строке (если это тре-
буется) является код клавиши  <ESC>,  при
нажатии  которой в строке появляется сим-
вол $.
    В командном режиме  используется  так
называемый  режим скрытого редактирования
при котором текст не виден, а  редактиро-
вание  производится  с  массивом символов
входящих в  текст.  Положение  курсора  в
этом  массиве управляется командами пере-
мещения на позицию  или  строку.  Команды
удаления  также  работают  с точностью до
позиции или строки.  Информацию  об  этих
командах можно всегда оперативно получить
по команде H.
    Перед  выполнением какой-либо команды
необходимо:
    - войти в командный режим;
    - набрать  необходимую  команду  (или
      последовательность команд) и нажать
      <ENTER>;
    - нажать клавишу входа в экранный ре-
      жим <V>;
    - нажать клавишу <ENTER>.
    Все  действия  можно выполнить набpав
необходимую последовательность  команд  и
завеpшив  ее  нажатием <ENTER>, напpимеp:
необходимо  загpузить  текст   с   именем
primer2.txt,  и начать его pедактиpование
с 5 стpоки в pежиме 64 символа в  стpоке.
Командная последовательность будет выгля-
деть   так:   Yprimer2.txt$B5LV64<ENTER>,
здесь:
    Y   -    команда    загpузки    файла
      primer2.txt с текущего диска;
    $  -  pазделитель, котоpый появляется
      пpи нажатии <ESC> (но не символ $);
    B - команда пеpехода в начало текста;
    5L - сдвиг куpсоpа впеpед на 5 стpок;
    V64 -  команда  пеpехода  в  экpанное
      pедактиpование  в pежиме 64 символа
      в стpоке.
    В дальнейшем описании командного  ре-
жима  редактирования будут использоваться
следующие обозначения:
    + команда выполняется вниз от курсора
(вперед);
    - команда выполняется вверх от курсо-
ра (назад).
    +- подразумевается + или -, по  умол-
чанию подразумевается +.
    n  означает  число. 1 - по умолчанию.
Максимальное  число  не  может  превышать
65535 (для его ввода можно указывать сим-
вол #), иначе на экране появится надпись,
говорящая  о том, что число слишком боль-
шое.
    $ означает ввод ESC или ENTER.
    ^  означает  нажатие  с  CTRL   (CAPS
SHIFT).
    [d:]  не обязательный указатель диска
(квадратные скобки не входят в указатель,
а обозначают его необязательность).
    
    
         6.2. Пеpемещение по тексту
    
    Команда +-nC переводит  курсор  на  n
символов в тексте. Например по команде 5C
курсор переместится на 5 символов вправо,
а по команде -3C курсор переместится на 3
символа влево.
    Команда  +-nL  переводит  курсор на n
строк в тексте, причем он устанавливается
на начало строки. Например по команде  5L
курсор переместится на 5 строк вниз, а по
команде  -2L  курсор  переместится  на  2
строки вверх.
    Команда В переводит курсор  в  начало
файла.
    Команда  -В  переводит курсор в конец
файла.
    
    
          6.3. Коppектиpовка текста
    
    Команда  +-nT  выводит  на  экран   n
строк. При + (вниз) выводит текст включая
строку  с курсором. При - (вверх) выводит
строки сверху до строки  с  курсором,  не
включая  ее. Если, например, курсор нахо-
дится на 3 строке и набрать  команду  3Т,
то  выведется  третья,  четвертая и пятая
строки. Если набрать  -2Т,  то  выведется
две предыдущие строки.
    Команда  +-nD  стирает  n  символов в
строке текста. При + стирается n символов
вправо от  курсора,  а  оставшаяся  часть
строки сдвигается на место стертых симво-
лов.  При - стирается n символов слева от
курсора не считая позиции курсора.
    Команда +-nK стирает n строк,  причем
та  строка,  на  которой находится курсор
стирается с того символа, на котором  на-
ходится курсор.
    Команда  +-n  сдвигает  курсор  на  n
строк и n+1 строка выводится на экран.
    Команда n! - вставит в текущую  пози-
цию курсора символ с кодом n (коды симво-
лов в 16-ричном формате можно просмотреть
в экранном режиме, нажав клавишу ^L).

    
    
       6.4. Операции с блоками текста
    
    Текстовый  редактор имеет специальную
буферную память, которая может  использо-
ваться для работы с блоками текста, кото-
рые  временно  помещаются в буфер с целью
их перестановки в тексте. Буфер можно до-
полнять или стирать. В буфере можно  хра-
нить  не только части текста, но и коман-
ды.
    nQP - помещает n строк  из  текста  в
буфер, начиная со строки, помеченной кур-
сором. Эти строки стираются из текста.
    n/QP  - добавляет n строк к буферу из
текста, начиная со строки, в которой  на-
ходится курсор.
    QT - выводит содержимое буфера на эк-
ран для его просмотра.
    nQG  -  копирует  содержимое буфера в
текст n раз. Содержимое буфера  при  этом
не изменяется.
    QK - очищает буфер от занесенного ту-
да текста.
    QX - позволяет выполнить команды, по-
мещенные в буфер.
    QLтекст$  -  поместит указанный в ко-
манде текст в буфер.
    n/QLтекст$ - добавит указанный в  ко-
манде текст в буфер n раз.


       6.5. Контекстный поиск и замена
    
    Команда  +-nFтекст$  осуществляет ко-
роткий (в памяти) поиск текста "текст"  и
установку   курсора   на  найденный  n-ый
текст.
    Команда +-nNтекст$ осуществляет длин-
ный (в файле) поиск текста "текст" и  ус-
тановку курсора на найденный n-ый текст.
    Команда  nIтекст$  вставит  указанный
"текст" n раз, начиная с положения курсо-
ра. Если поместить курсор на  пробел,  то
нужное  для  вставки  слово (предложение)
напечатается слитно с предыдущим.
    Команда nAтекст$ сделает добавление к
тексту. Если поместить  курсор  на  любой
символ  последней  строки, то эта команда
добавит "текст" к первоначальному  тексту
n  раз.  Если поместить курсор не на пос-
ледней  строке,  то  нужный  для  добавки
"текст" будет помещен между строк (строки
раздвинутся).
    Команда +-nSтекст1$текст2$ произведет
короткий (в памяти) поиск текста "текст1"
и заменит его текстом "текст2" n раз.
    Команда +-nRтекст1$текст2$ произведет
аналогичную замену, но только длинную (во
всем файле).
    Если  команды вводить как /F, /N, /S,
/R, то это приведет к выходу из <...> или
QX, если текст не найден.
    
    
              6.6. Макpокоманды
    
    В редактор встроена функция  исполне-
ния  последовательности  команд организо-
ванных в виде программы (макрокоманды), а
также набор команд для работы в этих мак-
рокомандах.
    nM... - циклическое исполнение набора
команд следующих за ней до конца  текущей
строки n раз;
    n<...>  -  то же что и nM, но команды
могут располагатся в  нескольких  строках
макрокоманды,   возможно  также  вложение
циклов друг в друга (по умолчанию n =  #,
т.е максимуму);
    ;  - указатель комментария;
    n(...)  - текст в скобка (до 8 симво-
лов) будет назначен  n-ой  функциональной
клавише (n=1..5).
    nZ - пауза n секунд;
    ?  - ожидание нажатия любой клавиши;
    n'...' - текст в кавычках будет выве-
ден на экран n раз (по умолчанию n=1);
    n"..." - текст в двойных кавычках бу-
дет  выведен на принтер n раз (по умолча-
нию 1 раз);
    В макрокомандах также можно использо-
вать любые команды редактора  рассмотрен-
ные выше.
    Рассмотрим  применение макрокоманд на
примерах:
    1. Необходимо  в  текст  вставить  40
символов  с кодом 9D (символ горизонталь-
ного элемента двойной рамки),  десятичный
код 9*16+13=157:
       40M 157! <ENTER>.
    То же самое будет выполнено если наб-
рать команду:
       40< 157!> <ENTER>.
    2.  Сформировать  в  тексте  рамку из
одинарных линий шириной 40 и  высотой  20
знакомест.  Эта макрокоманда набирается в
режиме экранного редактирования  и  будет
выглядеть так:
   ;рисование рамки 40*20 знаков
   170!        ;левый верхний угол рамки
   38<148!>    ;верхняя линия
   143!        ;правый верхний угол рамки
   13! 10!     ;конец строки
   18<         ;начало цикла на 18 строк
   131! 38I $131!
   13! 10!     ;конец строки
   >            ;конец цикла
   144!        ;левый нижний угол рамки
   38<148!>    ;нижняя линия
   169!        ;правый нижний угол рамки
   13! 10!     ;конец строки
    Указанный  текст  хранится на диске в
виде файла с именем  ramka.med,  для  его
исполнения в командном режиме введите ко-
манду: BYramka$B13QP.
    Данная  команда загрузит с диска файл
ramka.med и поместит его 13 строк  в  до-
полнительный  буфер.  Теперь  можно любым
способом установить курсор в нужное место
текста и набрать  команду  QX  (исполнить
макрокоманду  из  буфера). Затем командой
-20LV вернитесь в экранный режим и в тек-
сте увидете рамку, в начале которой будет
установлен курсор.
    Команда n(...) используется либо  для
назначения  функциональным клавишам часто
используеиых слов длиной до  8  символов,
либо для ввода часто используемых команд,
например:
    1.  При написании программ на ассемб-
лере часто  приходится  набирать  команды
PUSH   и   POP.   После   набора  команды
4(<TAB>PUSH<TAB>)   и    5(<TAB>POP<TAB>)
(здесь  <TAB> означает нажатие соответст-
вующей клавиши или клавиши ^I, эквивален-
тной ей, в тексте строки это будет  отоб-
ражатся  перемещением курсора на 8 симво-
лов вправо), нажатие F5 вставит  в  текст
PUSH,  а  F4  вставит  POP, обрамленные с
обеих сторон символами  табуляции,  оста-
нется  только подставить параметр, напри-
мер HL;
    2. Переход из режима ввода  текста  с
42  символами  в строке в режим его прос-
мотра с 64  символами  можно  осуществить
набрав команды 2($V42@) и 3($V64@) (здесь
символ  $  появляется при нажатии клавиши
<ESC>, а символ @ введенный с  клавиатуры
указывает на вставку в строку назначаемую
клавише  кода  <ENTER>). Теперь нажатие в
любом режиме  редактирования  клавиши  F2
приведет к переходу в экранный режим с 42
символами в строке, а нажатие F3 к режиму
64 символа в строке.
   Команда n'...' и n"..." в основном ис-
пользуются  при  формировании макрокоманд
печати и рассмотрены ниже в  разделе  6.8
"Печать файлов".
    
    
            6.7. Работа с файлами
    
    Команда  Q  отменяет работу редактора
без сохранения  редактируемого  текста  в
файле  на  диске.  Перед исполнением этой
команды на экране появится запрос "Закон-
чить (Y/N)?". Отвечать нужно в  латинском
режиме   (нажав   предварительно  клавишу
<LAT>), соответсвенно Y если действитель-
но необходим выход из редактора или любую
другую клавишу если команда вызвана  оши-
бочно.
    Команда E приводит к завершению рабо-
ты  редактора текста с сохранением редак-
тируемого текста в файле с  именем,  ука-
занным при запуске редактора текста.
    Команда  S предназначена для сохране-
ния редактируемого текста в файле с теку-
щим именем.
    Команда U завершает работу с редакти-
руемым текстом без его сохранения и восс-
танавливает предыдущую версию  текста  из
файла на диске. Перед исполнением появля-
ется  запрос  "Начать  с  начала (Y/N)?".
Ввод ответа аналогичен команде Q.
    Команда Y[d:]name.typ$ загружает файл
с именем name.typ с диска  d:  в  текущее
положение  курсора. После загрузки курсор
будет стоять в конце введенного файла.
    Команда nW[d:]name.typ$  сохраняет  n
строк,  начиная  со  строки с курсором, в
файле с именем name.typ на диске d:. Если
d: не указан файл будет сохранен на теку-
щем дисководе.
    
    
             6.8. Печать текста
    
    Для получения твердой копии  докумен-
тов подготовленных текстовым редактором в
него встроены команды работы с принтером:
    n% - установить номер страницы печати
= n;
    n"..."  -  вывести  на  принтер текст
набранный внутри двойных кавычек n раз;
    nP - вывести на печать n строк текста
начиная со строки,  в  которой  находится
курсор (курсор после печати установится в
начало  следующей после последней напеча-
танной строки).
    В тексте внутри кавычек можно исполь-
зовать символы используемые  как  команды
управления печатью:
    %  -  вывести на печать номер текущей
страницы;
    + - инкремент номера  печати  (приба-
вить к номеру 1);
    /  - выполнить команду перевода стра-
ницы (код 12);
    @ - выполнить команду возврат каретки
и перевод строки (коды 13 и 10 соответст-
венно).
    Внутри кавычек как и в  самом  тексте
можно  также использовать любые управляю-
щие коды, описанные в руководстве на кон-
кретный принтер используемый с  компьюте-
ром.
    Команда  n'...' используется в макро-
командах печати для выдачи на экран сооб-
щений пользователю. Внутри кавычек  также
можно использовать команды управления вы-
дачей на экран:
    / - очистка экрана;
    @ - переход на начало новой строки;
    $B8 - нормальный режим отображения;
    $B9 - инверсный режим отображения;
    ^G - выдача звукового сигнала;
    ^A - курсор в начало экрана.
    При печати текста редактор использует
для  перекодировки символов информацию из
файла с именем PRINTER.TAB. Это имя долж-
но быть присвоено файлу, содержащему таб-
лицу перекодировки используемого  принте-
ра. В базовом наборе имеется две таблицы,
одна  для  EPSON  совместимых принтеров с
именем EPSON.TAB, другая для принтера ти-
па  ПЗСУ-1  с  именем   PZSU1.TAB.   Файл
PRINTER.TAB  по умолчанию содержит инфор-
мацию из файла EPSON.TAB. Если вы исполь-
зуете принтер типа ПЗСУ-1, загрузите файл
PZSU1.TAB в редактор и  сохраните  его  с
именем PRINTER.TAB.
    Если вы используете принтер с отлича-
ющейся  от  заданных  кодировок, создайте
свой файл перекодировки, в котором каждо-
му символу отображаемому на экране  мони-
тора  (смотри таблицу кодировки экрана по
команде  ^L)  соответствует  код   вашего
принтера и назовите его PRINTER.TAB.
    Для  печати  файла удобнее всего соз-
дать макрокоманду и сохранить ее в файле.
Для примера ниже приведен текст файла пе-
чати данного описания находящийся на сис-
темном диске в файле PRINED.MED.
    
;печать файла ED.DOC
Yed.doc$B    ;загрузить и курсор в начало
1%           ;печать с 1 страницы
'^G/$B9 ВКЛЮЧИТЕ ПРИНТЕР $B8'
20<          ;20 страниц
'^A@@ установите лист и нажмите клавишу^G'
?
"редактор ED@"
64"-""@@"
52P          ;52 строки в странице
"@@"20" ""%+/"
3Z           ;пауза 3 секунды
>
    
    Для печати файла войдите  в  редактор
командой  ed  a (имя a здесь произвольное
только чтобы войти в редактор).  Клавишей
ESC перейдите в командный режим и набери-
те строку:
    Yprined$B14QPQX<ENTER>.

